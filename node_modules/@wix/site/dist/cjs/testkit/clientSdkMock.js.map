{"version":3,"names":["clientSdkMockBuilder","stubs","Map","builder","when","namespace","method","has","set","buildResponseResolver","argPredicate","thenResolveWith","response","stub","respond","get","thenResolveBy","withArgs","args","predicate","callArgs","every","arg","i","withAny","alwaysTruePredicate","build","invoke","_stubs$get","Error","JSON","stringify","exports","setClientSdkGlobal","clientSdk","window"],"sources":["../../../src/testkit/clientSdkMock.ts"],"sourcesContent":["import type { ClientSDK, WixNamespace } from '../types';\n\ntype ArgPredicate = (...args: unknown[]) => boolean;\n\ntype Respond = (...args: unknown[]) => unknown;\n\ninterface ClientSdkMethodStub {\n  argPredicate: ArgPredicate;\n  respond: Respond;\n}\n\ninterface ResponseResolver {\n  thenResolveWith(response: unknown): ClientSdkMockBuilder;\n  thenResolveBy(respond: Respond): ClientSdkMockBuilder;\n}\n\ninterface ClientSdkMockBuilder {\n  when(\n    namespace: WixNamespace,\n    method: string,\n  ): {\n    withArgs(...args: unknown[]): ResponseResolver;\n    withAny(): ResponseResolver;\n  };\n  build(): ClientSDK;\n}\n\nexport const clientSdkMockBuilder = () => {\n  const stubs = new Map<WixNamespace, Map<string, ClientSdkMethodStub>>();\n\n  const builder: ClientSdkMockBuilder = {\n    when(namespace: WixNamespace, method: string) {\n      if (!stubs.has(namespace)) {\n        stubs.set(namespace, new Map());\n      }\n\n      const buildResponseResolver = (argPredicate: ArgPredicate) => {\n        return {\n          thenResolveWith(response: unknown) {\n            const stub: ClientSdkMethodStub = {\n              argPredicate,\n              respond: () => response,\n            };\n\n            stubs.get(namespace)!.set(method, stub);\n            return builder;\n          },\n          thenResolveBy(respond: Respond) {\n            const stub: ClientSdkMethodStub = {\n              argPredicate,\n              respond,\n            };\n\n            stubs.get(namespace)!.set(method, stub);\n            return builder;\n          },\n        };\n      };\n\n      return {\n        withArgs(...args: unknown[]) {\n          const predicate: ArgPredicate = (...callArgs) => {\n            return args.every((arg, i) => arg === callArgs[i]);\n          };\n\n          return buildResponseResolver(predicate);\n        },\n        withAny() {\n          const alwaysTruePredicate = () => true;\n          return buildResponseResolver(alwaysTruePredicate);\n        },\n      };\n    },\n    build(): ClientSDK {\n      return {\n        invoke: async ({ namespace, method, args }) => {\n          const stub = stubs.get(namespace)?.get(method);\n          if (!stub) {\n            throw new Error(\n              `No stub found for ${namespace}.${method}(${JSON.stringify(\n                args,\n              )})`,\n            );\n          }\n\n          const response = stub.respond(...args);\n          return response as any;\n        },\n      };\n    },\n  };\n\n  return builder;\n};\n\nexport const setClientSdkGlobal = (clientSdk: ClientSDK) => {\n  window.clientSdk = clientSdk;\n};\n"],"mappings":";;;;AA2BO,MAAMA,oBAAoB,GAAGA,CAAA,KAAM;EACxC,MAAMC,KAAK,GAAG,IAAIC,GAAG,CAAiD,CAAC;EAEvE,MAAMC,OAA6B,GAAG;IACpCC,IAAIA,CAACC,SAAuB,EAAEC,MAAc,EAAE;MAC5C,IAAI,CAACL,KAAK,CAACM,GAAG,CAACF,SAAS,CAAC,EAAE;QACzBJ,KAAK,CAACO,GAAG,CAACH,SAAS,EAAE,IAAIH,GAAG,CAAC,CAAC,CAAC;MACjC;MAEA,MAAMO,qBAAqB,GAAIC,YAA0B,IAAK;QAC5D,OAAO;UACLC,eAAeA,CAACC,QAAiB,EAAE;YACjC,MAAMC,IAAyB,GAAG;cAChCH,YAAY;cACZI,OAAO,EAAEA,CAAA,KAAMF;YACjB,CAAC;YAEDX,KAAK,CAACc,GAAG,CAACV,SAAS,CAAC,CAAEG,GAAG,CAACF,MAAM,EAAEO,IAAI,CAAC;YACvC,OAAOV,OAAO;UAChB,CAAC;UACDa,aAAaA,CAACF,OAAgB,EAAE;YAC9B,MAAMD,IAAyB,GAAG;cAChCH,YAAY;cACZI;YACF,CAAC;YAEDb,KAAK,CAACc,GAAG,CAACV,SAAS,CAAC,CAAEG,GAAG,CAACF,MAAM,EAAEO,IAAI,CAAC;YACvC,OAAOV,OAAO;UAChB;QACF,CAAC;MACH,CAAC;MAED,OAAO;QACLc,QAAQA,CAAC,GAAGC,IAAe,EAAE;UAC3B,MAAMC,SAAuB,GAAGA,CAAC,GAAGC,QAAQ,KAAK;YAC/C,OAAOF,IAAI,CAACG,KAAK,CAAC,CAACC,GAAG,EAAEC,CAAC,KAAKD,GAAG,KAAKF,QAAQ,CAACG,CAAC,CAAC,CAAC;UACpD,CAAC;UAED,OAAOd,qBAAqB,CAACU,SAAS,CAAC;QACzC,CAAC;QACDK,OAAOA,CAAA,EAAG;UACR,MAAMC,mBAAmB,GAAGA,CAAA,KAAM,IAAI;UACtC,OAAOhB,qBAAqB,CAACgB,mBAAmB,CAAC;QACnD;MACF,CAAC;IACH,CAAC;IACDC,KAAKA,CAAA,EAAc;MACjB,OAAO;QACLC,MAAM,EAAE,MAAAA,CAAO;UAAEtB,SAAS;UAAEC,MAAM;UAAEY;QAAK,CAAC,KAAK;UAAA,IAAAU,UAAA;UAC7C,MAAMf,IAAI,IAAAe,UAAA,GAAG3B,KAAK,CAACc,GAAG,CAACV,SAAS,CAAC,qBAApBuB,UAAA,CAAsBb,GAAG,CAACT,MAAM,CAAC;UAC9C,IAAI,CAACO,IAAI,EAAE;YACT,MAAM,IAAIgB,KAAK,CACZ,qBAAoBxB,SAAU,IAAGC,MAAO,IAAGwB,IAAI,CAACC,SAAS,CACxDb,IACF,CAAE,GACJ,CAAC;UACH;UAEA,MAAMN,QAAQ,GAAGC,IAAI,CAACC,OAAO,CAAC,GAAGI,IAAI,CAAC;UACtC,OAAON,QAAQ;QACjB;MACF,CAAC;IACH;EACF,CAAC;EAED,OAAOT,OAAO;AAChB,CAAC;AAAC6B,OAAA,CAAAhC,oBAAA,GAAAA,oBAAA;AAEK,MAAMiC,kBAAkB,GAAIC,SAAoB,IAAK;EAC1DC,MAAM,CAACD,SAAS,GAAGA,SAAS;AAC9B,CAAC;AAACF,OAAA,CAAAC,kBAAA,GAAAA,kBAAA"}